# SSE Server Configuration
# Port 0 = random port (avoids conflicts in local dev)
# Overridden to 8080 in containers via QUARKUS_HTTP_PORT env var
quarkus.http.port=0
quarkus.http.host=0.0.0.0
quarkus.banner.path=my-logo.txt
# CORS Configuration for browser access
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=Content-Disposition
quarkus.http.cors.access-control-max-age=24H

# MCP SSE is enabled by default when using quarkus-mcp-server-sse
# Default endpoint: /mcp/sse

# ============================================================
# AUTHENTICATION & AUTHORIZATION
# ============================================================

# OIDC Configuration - Token Validation
# The MCP server validates incoming JWT tokens from users
# No client secret needed for token validation (public OIDC discovery)
quarkus.oidc.auth-server-url=${KC_URL}/realms/${KC_REALM:master}
quarkus.oidc.client-id=${OIDC_CLIENT_ID:mcp-server}
quarkus.oidc.application-type=service
quarkus.oidc.token.issuer=${KC_URL}/realms/${KC_REALM:master}

# Security Policies - Require authentication for MCP endpoints
quarkus.http.auth.permission.mcp.paths=/mcp/*
quarkus.http.auth.permission.mcp.policy=authenticated

# Public endpoints (health checks, metrics)
quarkus.http.auth.permission.public.paths=/q/*
quarkus.http.auth.permission.public.policy=permit

# Development Mode - Disable authentication for local dev
%dev.quarkus.http.auth.permission.mcp.policy=permit
%dev.quarkus.oidc.enabled=false

# ============================================================
# KEYCLOAK CONNECTION
# ============================================================
# The MCP server uses the authenticated user's JWT token to
# call the Keycloak Admin API.
# ============================================================
# Keycloak server URL (required)
# This is used to connect to Keycloak Admin API
# Example: https://keycloak.example.com or http://localhost:8180
quarkus.keycloak.admin-client.server-url=${KC_URL}

# Dev services: integrations to test containers is disabled
quarkus.keycloak.devservices.enabled=false

# Container Image Configuration (Jib)
# Build is disabled by default. Enable with: -Dquarkus.container-image.build=true
quarkus.container-image.build=false
quarkus.container-image.registry=quay.io
quarkus.container-image.group=sshaaf
quarkus.container-image.name=keycloak-mcp-server
quarkus.container-image.tag=@git.commit.id.abbrev@
quarkus.container-image.additional-tags=latest

# Jib specific configuration
quarkus.jib.base-jvm-image=registry.access.redhat.com/ubi9/openjdk-21-runtime:1.20
quarkus.jib.platforms=linux/amd64,linux/arm64
quarkus.jib.ports=8080

# Environment variables in the container
# Override port to 8080 in containers (default is 0 for local dev)
quarkus.jib.environment-variables.QUARKUS_HTTP_PORT=8080
quarkus.jib.environment-variables.KC_URL=https://keycloak:8443
quarkus.jib.environment-variables.KC_REALM=master

# SSL/TLS Configuration
# Trust mounted CA certificate (for OpenShift/Kubernetes with custom CAs)
quarkus.tls.trust-all=true
